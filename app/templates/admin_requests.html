{% extends "layout_dashboard.html" %}
{% block title %}Access Requests{% endblock %}
{% block content %}
<div class="space-y-6">
  {% include "admin/_back_to_admin.html" %}
  <h1 class="text-3xl font-bold text-{{ accent }}-400">Access Requests</h1>

  <section class="rounded-2xl border p-6 shadow-lg {% if theme == 'light' %}bg-white border-gray-200{% else %}bg-slate-800 border-slate-700{% endif %}">
    <h2 class="text-2xl font-semibold text-{{ accent }}-400 mb-3">Pending</h2>
    {% if pending %}
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm {% if theme == 'light' %}text-gray-800{% else %}text-slate-200{% endif %}">
          <thead class="{% if theme == 'light' %}bg-gray-100 text-gray-700{% else %}bg-slate-900/70 text-slate-300{% endif %}">
            <tr>
              <th class="px-3 py-2 text-left">Username</th>
              <th class="px-3 py-2 text-left">Email</th>
              <th class="px-3 py-2 text-left">Reason</th>
              <th class="px-3 py-2 text-left">Submitted</th>
              <th class="px-3 py-2 text-left">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for r in pending %}
            <tr class="{% if theme == 'light' %}border-b border-gray-200{% else %}border-b border-slate-700/60{% endif %}">
              <td class="px-3 py-2 font-semibold">{{ r.username }}</td>
              <td class="px-3 py-2">{{ r.email }}</td>
              <td class="px-3 py-2">{{ r.reason }}</td>
              <td class="px-3 py-2">{{ r.created_at }}</td>
              <td class="px-3 py-2 space-x-2">
                <a class="text-emerald-500 hover:underline"
                   href="{{ url_for('access.handle_request', id=r.id, action='approve') }}">Approve</a>
                <a class="text-rose-500 hover:underline"
                   href="{{ url_for('access.handle_request', id=r.id, action='deny') }}">Deny</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="{% if theme == 'light' %}text-gray-600{% else %}text-slate-400{% endif %}">No pending requests.</p>
    {% endif %}
  </section>

  <section class="rounded-2xl border p-6 shadow-lg {% if theme == 'light' %}bg-white border-gray-200{% else %}bg-slate-800 border-slate-700{% endif %}">
    <h2 class="text-2xl font-semibold text-{{ accent }}-400 mb-3">Recent Decisions</h2>
    {% if decided %}
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm {% if theme == 'light' %}text-gray-800{% else %}text-slate-200{% endif %}">
          <thead class="{% if theme == 'light' %}bg-gray-100 text-gray-700{% else %}bg-slate-900/70 text-slate-300{% endif %}">
            <tr>
              <th class="px-3 py-2 text-left">Username</th>
              <th class="px-3 py-2 text-left">Email</th>
              <th class="px-3 py-2 text-left">Status</th>
              <th class="px-3 py-2 text-left">Decision Time</th>
            </tr>
          </thead>
          <tbody>
            {% for r in decided %}
            <tr class="{% if theme == 'light' %}border-b border-gray-200{% else %}border-b border-slate-700/60{% endif %}">
              <td class="px-3 py-2 font-semibold">{{ r.username }}</td>
              <td class="px-3 py-2">{{ r.email }}</td>
              <td class="px-3 py-2">{{ r.status|capitalize }}</td>
              <td class="px-3 py-2">{{ r.approval_time or 'â€”' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="{% if theme == 'light' %}text-gray-600{% else %}text-slate-400{% endif %}">No recent decisions.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
